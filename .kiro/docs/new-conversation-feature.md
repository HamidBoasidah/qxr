# ميزة إنشاء محادثة جديدة

## نظرة عامة
تم إضافة ميزة جديدة تسمح للمستخدمين ببدء محادثات جديدة مع مستخدمين آخرين من خلال واجهة بحث سهلة الاستخدام.

## الملفات المضافة/المعدلة

### 1. ملفات جديدة
- `resources/js/components/company/chat/NewConversationModal.vue` - مكون Modal لإنشاء محادثة جديدة

### 2. ملفات معدلة
- `resources/js/pages/Company/Chat/Index.vue` - إضافة زر "محادثة جديدة" والـ modal
- `resources/js/locales/ar.json` - إضافة ترجمات عربية
- `resources/js/locales/en.json` - إضافة ترجمات إنجليزية

## كيفية الاستخدام

### من واجهة المستخدم:
1. انتقل إلى صفحة المحادثات (`/company/chat/conversations`)
2. انقر على زر "محادثة جديدة" (أيقونة + في الزاوية العلوية)
3. سيظهر modal يحتوي على:
   - حقل بحث للبحث عن المستخدمين
   - قائمة بجميع المستخدمين (ماعدا المستخدم الحالي)
4. ابحث عن المستخدم المطلوب بالاسم أو البريد الإلكتروني
5. انقر على المستخدم لبدء المحادثة
6. سيتم:
   - إنشاء محادثة جديدة إذا لم تكن موجودة
   - أو فتح المحادثة الموجودة إذا كانت موجودة مسبقاً

## المميزات

### 1. البحث الذكي
- بحث فوري مع debounce (500ms)
- البحث بالاسم أو البريد الإلكتروني
- استبعاد المستخدم الحالي تلقائياً

### 2. واجهة مستخدم محسنة
- عرض صورة المستخدم أو الأحرف الأولى
- معلومات واضحة (الاسم والبريد الإلكتروني)
- حالات تحميل وفارغة واضحة
- تصميم متجاوب (Dark mode support)

### 3. معالجة الأخطاء
- رسائل خطأ واضحة
- منع إنشاء محادثة مع نفس المستخدم
- التحقق من وجود المستخدم

### 4. الأمان
- استخدام Policy للتحقق من الصلاحيات
- التحقق من صحة البيانات في الـ backend
- منع الوصول غير المصرح به

## API Endpoints المستخدمة

### 1. جلب المستخدمين
```
GET /company/users?search={query}&per_page=50
```

### 2. إنشاء/جلب محادثة
```
POST /company/chat/conversations
Body: { user_id: number }
```

**الاستجابة:**
- إذا كانت المحادثة موجودة: يتم إرجاع المحادثة الموجودة
- إذا لم تكن موجودة: يتم إنشاء محادثة جديدة

## الترجمات المضافة

### العربية (ar.json)
```json
{
  "chat": {
    "newConversation": "محادثة جديدة",
    "searchUsers": "ابحث عن مستخدم",
    "searchUsersPlaceholder": "ابحث بالاسم أو البريد الإلكتروني...",
    "noUsersFound": "لم يتم العثور على مستخدمين.",
    "noUsers": "لا يوجد مستخدمون.",
    "errorCreatingConversation": "حدث خطأ أثناء إنشاء المحادثة"
  }
}
```

### الإنجليزية (en.json)
```json
{
  "chat": {
    "newConversation": "New Conversation",
    "searchUsers": "Search for a user",
    "searchUsersPlaceholder": "Search by name or email...",
    "noUsersFound": "No users found.",
    "noUsers": "No users available.",
    "errorCreatingConversation": "An error occurred while creating the conversation"
  }
}
```

## الاختبار

### اختبار يدوي:
1. ✅ فتح modal المحادثة الجديدة
2. ✅ البحث عن مستخدمين
3. ✅ إنشاء محادثة جديدة
4. ✅ فتح محادثة موجودة
5. ✅ معالجة الأخطاء
6. ✅ Dark mode
7. ✅ Responsive design

### سيناريوهات الاختبار:
- [ ] محاولة إنشاء محادثة مع مستخدم جديد
- [ ] محاولة إنشاء محادثة مع مستخدم لديك محادثة معه مسبقاً
- [ ] البحث عن مستخدم غير موجود
- [ ] إغلاق Modal بدون اختيار مستخدم
- [ ] اختبار على شاشات مختلفة (Mobile, Tablet, Desktop)

## ملاحظات تقنية

### Props المطلوبة:
- `isOpen` (Boolean): حالة فتح/إغلاق الـ modal
- `authUserId` (Number): معرف المستخدم الحالي

### Events:
- `@close`: يتم إطلاقه عند إغلاق الـ modal

### Dependencies:
- Vue 3
- Inertia.js
- Axios
- vue-i18n

## التحسينات المستقبلية المقترحة

1. إضافة pagination للمستخدمين
2. إضافة فلاتر إضافية (نوع المستخدم، الحالة، إلخ)
3. إضافة إمكانية إنشاء محادثات جماعية
4. إضافة معاينة سريعة للمستخدم
5. حفظ آخر عمليات البحث
6. إضافة اختبارات آلية (Unit tests)

## الدعم

في حالة وجود أي مشاكل أو استفسارات، يرجى التواصل مع فريق التطوير.
